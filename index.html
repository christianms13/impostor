<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÄ Impostor Coquette</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #fff0f5; /* Lavender Blush */
            --card-bg: rgba(255, 255, 255, 0.85);
            --primary: #ffb7c5; /* Cherry Blossom Pink */
            --accent: #ff69b4; /* Hot Pink */
            --text-main: #6d4c41; /* Marr√≥n suave */
            --gold: #d4af37;
            --shadow: rgba(255, 105, 180, 0.2);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 183, 197, 0.4) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 224, 0.6) 0%, transparent 20%);
        }

        /* FONDO ANIMADO COQUETTE */
        .bg-emojis {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        .bg-emoji {
            position: absolute;
            font-size: 2rem;
            animation: floatUp 15s linear infinite;
            opacity: 0.6;
        }
        @keyframes floatUp {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            color: var(--accent);
            margin: 10px 0;
            text-shadow: 2px 2px 0px white, 4px 4px 0px rgba(255, 182, 193, 0.5);
            position: relative;
        }
        h1::after {
            content: "üéÄ";
            font-size: 1.5rem;
            position: absolute;
            top: 0; right: -20px;
            transform: rotate(15deg);
        }

        .container {
            background-color: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 2.5rem;
            border-radius: 30px;
            border: 2px solid white;
            box-shadow: 
                0 10px 30px var(--shadow),
                inset 0 0 20px rgba(255,255,255,0.8);
            max-width: 500px;
            width: 100%;
            text-align: center;
            position: relative;
            margin-top: 20px;
        }

        /* Decoraci√≥n de Lazo CSS puro en la caja */
        .container::before {
            content: "‚ú®";
            position: absolute; top: 10px; left: 15px; font-size: 1.2rem;
        }
        .container::after {
            content: "‚ú®";
            position: absolute; bottom: 10px; right: 15px; font-size: 1.2rem;
        }

        h2 { font-family: 'Dancing Script', cursive; color: var(--text-main); font-size: 2rem; margin-top: 0;}

        input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 20px;
            color: var(--text-main);
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            text-align: center;
            outline: none;
            transition: 0.3s;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--primary); }
        input::placeholder { color: #ccb0b0; }

        button {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
            transition: transform 0.2s;
            font-family: 'Quicksand', sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        button:hover { transform: scale(1.03); filter: brightness(1.05); }
        
        button.secondary {
            background: white;
            border: 2px solid var(--primary);
            color: var(--accent);
            box-shadow: none;
        }
        button.secondary:hover { background: var(--bg-color); }

        button.danger {
            background: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%);
        }

        .hidden { display: none !important; }
        
        /* Listas bonitas */
        .player-list { list-style: none; padding: 0; text-align: left; }
        .player-list li {
            background: white;
            margin: 8px 0;
            padding: 10px 15px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            color: var(--text-main);
            border: 1px solid var(--primary);
        }

        .role-card {
            border: 2px dashed var(--accent);
            padding: 20px;
            border-radius: 20px;
            background: rgba(255,255,255,0.5);
            margin-top: 10px;
        }

        .secret-word {
            font-size: 2.5rem;
            font-family: 'Dancing Script', cursive;
            color: var(--accent);
            margin: 10px 0;
            text-shadow: 2px 2px 0px white;
            word-wrap: break-word;
        }

        .description-box {
            font-size: 0.9rem;
            color: #886;
            background: #fff;
            padding: 10px;
            border-radius: 10px;
            font-style: italic;
            border: 1px solid #eee;
            margin-top: 5px;
        }

        .impostor-title {
            color: #ff4d6d;
            font-size: 2.2rem;
            font-family: 'Dancing Script', cursive;
            font-weight: bold;
            animation: heartbeat 1.5s infinite;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .turn-list { margin-top: 15px; text-align: left; font-size: 0.9rem; }
        .turn-list li { padding: 5px 0; border-bottom: 1px dotted var(--primary); color: var(--text-main); }
        .turn-list li:first-child { color: var(--accent); font-weight: bold; }
        .turn-list li:first-child::after { content: " üé§ (Empieza)"; }

        #roomIdDisplay { 
            font-family: 'Quicksand', monospace; 
            letter-spacing: 1px; 
            color: var(--accent);
            cursor: pointer;
            border: 2px dashed var(--primary);
        }

        .kick-btn {
            background: transparent; border: 1px solid #ff4d6d; color: #ff4d6d;
            width: auto; padding: 4px 10px; margin: 0; font-size: 0.7rem; box-shadow: none;
        }
        .kick-btn:hover { background: #ff4d6d; color: white; transform: none; }

    </style>
</head>
<body>

    <div id="emoji-bg" class="bg-emojis"></div>

    <h1>The Impostor</h1>
    <div style="font-size: 0.9rem; color: var(--accent); margin-bottom: 20px; background: white; padding: 5px 15px; border-radius: 50px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
        ‚ú® Coquette Edition ‚ú®
    </div>
    
    <div id="statusMsg" style="color: #997; font-size: 0.8rem; height: 20px;"></div>

    <div id="screen-menu" class="container">
        <h2>Bienvenida, linda ü¶¢</h2>
        <input type="text" id="myUsername" placeholder="Tu nombre..." maxlength="12">
        <button onclick="createGame()">Crear Salita üéÄ</button>
        <div style="margin: 15px 0; color: #bca; font-size: 0.8rem;">‚Äî o √∫nete a una amiga ‚Äî</div>
        <input type="text" id="joinInput" placeholder="C√≥digo de la sala">
        <button class="secondary" onclick="joinGame()">Unirse ‚ú®</button>
    </div>

    <div id="screen-lobby" class="container hidden">
        <h2>Sala de Espera üß∏</h2>
        <p style="font-size: 0.8rem; color: #886;">Comparte este c√≥digo (toca para copiar):</p>
        
        <input type="text" id="roomIdDisplay" readonly onclick="copyRoomCode()">

        <div style="margin-top: 20px; text-align: left;">
            <h3 style="font-family: 'Dancing Script'; color: var(--text-main); font-size: 1.5rem;">
                Jugadoras (<span id="playerCount">0</span>) ü©∞
            </h3>
        </div>
        <ul id="lobbyList" class="player-list"></ul>

        <div id="hostControls" class="hidden" style="margin-top: 25px;">
            <div style="background: #fff; padding: 10px; border-radius: 15px; border: 1px solid var(--primary); margin-bottom: 15px;">
                <p style="font-size: 0.8rem; margin: 0; color: #665;">
                    üí° <b>Modo Smart:</b> Buscando palabras famosas, celebridades y cosas comunes en Espa√±a.
                </p>
            </div>
            <button onclick="startGame()" id="btnStart">üíñ Empezar Partida üíñ</button>
        </div>
        <div id="clientWaiting" class="hidden">
            <p style="color: var(--accent); animation: heartbeat 2s infinite;">Esperando a la Host... üíÖ</p>
        </div>
    </div>

    <div id="screen-game" class="container hidden">
        <div class="role-card">
            <p style="color: #886; font-size: 0.9rem;">TU IDENTIDAD SECRETA:</p>
            <h3 id="roleDisplay" style="font-family: 'Dancing Script'; font-size: 2rem; margin: 5px 0;">...</h3>
            
            <div id="wordContainer">
                <hr style="border: 0; border-top: 2px dotted var(--primary); margin: 15px 0;">
                <p style="font-size:0.8rem; color: #886; letter-spacing: 1px;">LA PALABRA ES:</p>
                <div id="secretWordDisplay" class="secret-word">???</div>
                <div id="secretDescDisplay" class="description-box">Cargando info...</div>
            </div>
            
            <div id="impostorMessage" class="hidden">
                <hr style="border: 0; border-top: 2px dotted var(--primary); margin: 15px 0;">
                <div class="impostor-title">IMPOSTORA</div>
                <p style="color: var(--text-main);">ü§´ Shhh... no sabes nada.<br>¬°Miente con estilo!</p>
            </div>
        </div>

        <div style="margin-top: 20px; background: rgba(255,255,255,0.6); padding: 15px; border-radius: 15px;">
            <p style="font-size: 0.9rem; color: var(--accent); font-weight: bold; margin:0 0 10px 0;">üéÄ Orden de Turnos:</p>
            <ol id="turnOrderList" class="turn-list"></ol>
        </div>
        
        <div id="hostGameControls" class="hidden" style="margin-top: 20px;">
            <button class="danger" onclick="revealGame()">üíî Terminar Ronda</button>
        </div>
        <p id="waitingReveal" class="hidden" style="margin-top:20px; color:#998; font-size: 0.8rem;">Jugando... ü¶¢</p>
    </div>

    <div id="screen-result" class="container hidden">
        <h2>Resultados ‚ú®</h2>
        
        <div style="background: white; padding: 15px; border-radius: 20px; border: 1px solid var(--primary); margin-bottom: 20px;">
            <p style="color:#886; font-size: 0.8rem; margin:0;">La palabra era:</p>
            <div id="finalWord" style="font-size: 1.8rem; color: var(--accent); font-family: 'Dancing Script'; font-weight: bold;"></div>
            <p id="finalDesc" style="font-size: 0.75rem; color: #998; font-style: italic;"></p>
        </div>

        <p style="color:#886; font-size: 0.9rem;">La Impostora era:</p>
        <h3 id="finalImpostor" style="font-family: 'Dancing Script'; font-size: 2.5rem; color: #ff4d6d; margin: 0;"></h3>
        
        <div id="hostRestartControls" class="hidden">
            <button onclick="returnToLobby()">üîÑ Volver al Lobby</button>
        </div>
        <p id="clientRestartWaiting" class="hidden" style="color:#886;">Esperando a la Host...</p>
    </div>

    <script>
        // --- GENERADOR DE FONDO COQUETTE ---
        const emojis = ["üéÄ", "ü¶¢", "ü©∞", "üíÑ", "üßÅ", "üß∏", "üíñ", "ü¶™", "üçí", "‚ú®", "üç∞", "üíå"];
        const bgContainer = document.getElementById('emoji-bg');
        
        for(let i=0; i<20; i++) {
            const el = document.createElement('div');
            el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            el.className = 'bg-emoji';
            el.style.left = Math.random() * 100 + 'vw';
            el.style.animationDuration = (Math.random() * 10 + 10) + 's';
            el.style.animationDelay = Math.random() * 5 + 's';
            el.style.fontSize = (Math.random() * 1.5 + 1) + 'rem';
            bgContainer.appendChild(el);
        }

        // --- LISTA DE "SEMILLAS" DE B√öSQUEDA INTELIGENTE ---
        // Estas semillas garantizan que Wikipedia devuelva cosas FAMOSAS y COMUNES en Espa√±a.
        const SEARCH_SEEDS = [
            // Celebridades & Famosos
            "Cantantes de pop famosos", "Futbolistas famosos de la historia", "Actores de Hollywood famosos", "Celebridades de internet",
            "Directores de cine famosos", "Cantantes de reguet√≥n", "Presentadores de televisi√≥n de Espa√±a", "Famosos de Espa√±a",
            "Personajes de Harry Potter", "Superh√©roes de Marvel", "Princesas Disney", "Jugadores del Real Madrid", "Jugadores del FC Barcelona",
            "Artistas famosos de la historia", "Escritores famosos universales", "Personajes de Star Wars", "Personajes de Los Simpson",
            
            // Objetos & Vida Diaria
            "Muebles de casa", "Electrodom√©sticos de cocina", "Frutas comunes", "Verduras comunes", 
            "Ropa de mujer", "Accesorios de moda", "Instrumentos musicales populares", "Material escolar",
            "Juguetes famosos", "Herramientas de bricolaje", "Medios de transporte", "Partes del cuerpo humano",
            "Maquillaje", "Dulces y postres", "Bebidas alcoh√≥licas famosas", "Platos t√≠picos de Espa√±a",
            
            // Lugares
            "Ciudades de Espa√±a", "Capitales de Europa", "Monumentos famosos del mundo", "Tiendas de ropa famosas",
            "Cadenas de comida r√°pida", "Lugares de la casa", "Pa√≠ses de Am√©rica Latina", "Destinos tur√≠sticos populares",
            
            // Animales & Naturaleza
            "Animales de la selva", "Animales de granja", "Razas de perros populares", "Flores comunes", "Animales marinos",
            
            // Conceptos Random pero Comunes
            "Deportes ol√≠mpicos", "Redes sociales", "Marcas de coches", "Profesiones comunes", "Estaciones del a√±o", "Fiestas populares"
        ];

        // --- LOGICA DE CONEXI√ìN ---
        let peer = null;
        let connections = [];
        let isHost = false;
        let myName = "";
        let players = []; 
        let gameState = {};
        
        const screens = ['menu', 'lobby', 'game', 'result'];

        function showScreen(name) {
            screens.forEach(s => document.getElementById(`screen-${s}`).classList.add('hidden'));
            document.getElementById(`screen-${name}`).classList.remove('hidden');
        }

        function updateStatus(msg) { document.getElementById('statusMsg').innerText = msg; }

        // --- CEREBRO: SMART SEARCH WIKIPEDIA ---
        async function fetchCommonWord() {
            // 1. Elegimos una semilla aleatoria (Ej: "Frutas comunes" o "Futbolistas famosos")
            const seed = SEARCH_SEEDS[Math.floor(Math.random() * SEARCH_SEEDS.length)];
            console.log("Semilla elegida:", seed);

            // 2. Buscamos en Wikipedia usando "generator=search". 
            // Wikipedia ordena por RELEVANCIA, as√≠ que los primeros resultados son siempre los m√°s famosos.
            const url = `https://es.wikipedia.org/w/api.php?action=query&generator=search&gsrsearch=${encodeURIComponent(seed)}&gsrlimit=20&prop=extracts&exintro&explaintext&exchars=250&format=json&origin=*`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                
                if (!data.query || !data.query.pages) throw new Error("Sin resultados");

                const pages = Object.values(data.query.pages);

                // 3. Filtramos basura
                let validPages = pages.filter(p => {
                    const t = p.title;
                    const desc = p.extract;
                    if (!desc || desc.length < 10) return false;
                    if (t.startsWith("Anexo:") || t.startsWith("Lista de") || t.startsWith("Categor√≠a:")) return false;
                    if (t.includes("Discograf√≠a") || t.includes("Bibliograf√≠a")) return false;
                    return true;
                });

                if (validPages.length === 0) validPages = pages; // Fallback

                // 4. Elegimos uno al azar de los Top 20 resultados m√°s relevantes
                const winner = validPages[Math.floor(Math.random() * validPages.length)];

                // Limpieza de texto
                let cleanDesc = winner.extract.split('.')[0] + "."; // Primera frase suele ser la mejor
                if (cleanDesc.length > 150) cleanDesc = cleanDesc.substring(0, 150) + "...";

                return { title: winner.title, desc: cleanDesc, category: seed };

            } catch (e) {
                console.error("Wiki Error:", e);
                // Fallback por si explota la API
                const fallbacks = [
                    {title: "Taylor Swift", desc: "Cantautora estadounidense, una de las artistas m√°s populares."},
                    {title: "Pizza", desc: "Plato italiano consistente en una base de masa con tomate y queso."},
                    {title: "Ibai Llanos", desc: "Streamer, youtuber y presentador de deportes electr√≥nicos espa√±ol."},
                    {title: "Par√≠s", desc: "Capital de Francia, conocida por la Torre Eiffel."}
                ];
                return fallbacks[Math.floor(Math.random() * fallbacks.length)];
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- PEERJS & LOGICA ---
        function createGame() {
            myName = document.getElementById('myUsername').value.trim() || "Princesa";
            isHost = true;
            updateStatus("Creando mundo rosa... üéÄ");
            peer = new Peer(null, { debug: 1 });
            
            peer.on('open', (id) => {
                document.getElementById('roomIdDisplay').value = id;
                updateStatus("");
                players = [{ id: id, name: myName, isHost: true }];
                updateLobbyUI();
                showScreen('lobby');
                document.getElementById('hostControls').classList.remove('hidden');
            });

            peer.on('connection', (c) => {
                c.on('open', () => { c.on('data', (d) => handleDataHost(d, c)); });
                c.on('close', () => {
                    // Manejo de desconexi√≥n
                    players = players.filter(p => p.id !== c.peer);
                    connections = connections.filter(con => con.peer !== c.peer);
                    broadcastLobby();
                });
            });
        }

        function joinGame() {
            myName = document.getElementById('myUsername').value.trim() || "Hada";
            const roomId = document.getElementById('joinInput').value.trim();
            if (!roomId) return alert("¬°Falta el c√≥digo de la sala! ü•∫");
            
            isHost = false;
            updateStatus("Volando hacia la sala... ü¶¢");
            peer = new Peer(null, { debug: 1 });
            
            peer.on('open', (id) => {
                const conn = peer.connect(roomId);
                conn.on('open', () => {
                    updateStatus("¬°Llegaste! ‚ú®");
                    conn.send({ type: 'JOIN', name: myName, id: id });
                    connections = [conn]; 
                });
                conn.on('data', (d) => handleDataClient(d));
                conn.on('close', () => { alert("La sala cerr√≥ sus puertas üíî"); location.reload(); });
            });
            peer.on('error', () => alert("No encuentro esa sala, revisa el c√≥digo ü•∫"));
        }

        function handleDataHost(data, connSource) {
            if (data.type === 'JOIN') {
                if (!players.find(p => p.id === data.id)) {
                    connections.push(connSource);
                    players.push({ id: data.id, name: data.name });
                    broadcastLobby();
                }
            }
        }

        function handleDataClient(data) {
            if (data.type === 'LOBBY') {
                players = data.players;
                showScreen('lobby');
                // IMPORTANTE: Actualizar UI y Contador
                updateLobbyUI();
                document.getElementById('hostControls').classList.add('hidden');
                document.getElementById('clientWaiting').classList.remove('hidden');
            }
            if (data.type === 'START') setupGame(data.wordData, data.impostor, data.order);
            if (data.type === 'REVEAL') showResult(data.wordData, data.impostorName);
            if (data.type === 'RESET') showScreen('lobby');
        }

        function broadcastLobby() {
            const safePlayers = players.map(p => ({ id: p.id, name: p.name, isHost: p.isHost }));
            const msg = { type: 'LOBBY', players: safePlayers };
            if (!isHost) return;
            // Host actualiza su propia UI
            updateLobbyUI();
            connections.forEach(c => c.send(msg));
        }

        async function startGame() {
            if (players.length < 3 && !confirm("Sois poquitas (menos de 3). ¬øJugar igual?")) return;
            
            const btn = document.getElementById('btnStart');
            btn.innerText = "‚ú® Buscando magia... ‚ú®";
            btn.disabled = true;

            // Fetch inteligente
            const wordData = await fetchCommonWord(); 
            
            const impostor = players[Math.floor(Math.random() * players.length)];
            
            let turnOrder = [...players];
            turnOrder = shuffleArray(turnOrder).map(p => p.name);

            gameState = { wordData: wordData, impostorName: impostor.name };
            
            const msg = { 
                type: 'START', 
                wordData: wordData, 
                impostor: impostor.id,
                order: turnOrder
            };
            
            connections.forEach(c => c.send(msg));
            setupGame(wordData, impostor.id, turnOrder);

            btn.innerText = "üíñ Empezar Partida üíñ";
            btn.disabled = false;
        }

        function setupGame(wordData, impostorId, orderList) {
            showScreen('game');
            const amIImpostor = (peer.id === impostorId);
            
            const roleTxt = document.getElementById('roleDisplay');
            if (amIImpostor) {
                roleTxt.innerText = "üíî Eres la IMPOSTORA";
                roleTxt.style.color = "#ff4d6d";
                document.getElementById('wordContainer').classList.add('hidden');
                document.getElementById('impostorMessage').classList.remove('hidden');
            } else {
                roleTxt.innerText = "üíñ Eres CIUDADANA";
                roleTxt.style.color = "var(--accent)";
                document.getElementById('wordContainer').classList.remove('hidden');
                document.getElementById('impostorMessage').classList.add('hidden');
                
                document.getElementById('secretWordDisplay').innerText = wordData.title;
                document.getElementById('secretDescDisplay').innerText = wordData.desc;
            }

            const ul = document.getElementById('turnOrderList');
            ul.innerHTML = '';
            orderList.forEach((name, index) => {
                const li = document.createElement('li');
                li.innerText = `${index + 1}. ${name}`;
                ul.appendChild(li);
            });

            if (isHost) {
                document.getElementById('hostGameControls').classList.remove('hidden');
                document.getElementById('waitingReveal').classList.add('hidden');
            } else {
                document.getElementById('hostGameControls').classList.add('hidden');
                document.getElementById('waitingReveal').classList.remove('hidden');
            }
        }

        function revealGame() {
            const msg = { type: 'REVEAL', wordData: gameState.wordData, impostorName: gameState.impostorName };
            connections.forEach(c => c.send(msg));
            showResult(msg.wordData, msg.impostorName);
        }

        function showResult(wordData, impostorName) {
            showScreen('result');
            document.getElementById('finalWord').innerText = wordData.title;
            document.getElementById('finalDesc').innerText = wordData.desc;
            document.getElementById('finalImpostor').innerText = impostorName;
            
            if(isHost) {
                document.getElementById('hostRestartControls').classList.remove('hidden');
                document.getElementById('clientRestartWaiting').classList.add('hidden');
            } else {
                document.getElementById('hostRestartControls').classList.add('hidden');
                document.getElementById('clientRestartWaiting').classList.remove('hidden');
            }
        }

        function returnToLobby() {
            broadcastLobby();
            connections.forEach(c => c.send({ type: 'RESET' }));
            showScreen('lobby');
        }

        function kickPlayer(id) {
            if(!confirm("¬øSacar a esta persona? üíî")) return;
            const conn = connections.find(c => c.peer === id);
            if (conn) conn.close();
            players = players.filter(p => p.id !== id);
            connections = connections.filter(c => c.peer !== id);
            broadcastLobby();
        }

        // --- ARREGLO DEL CONTADOR ---
        function updateLobbyUI() {
            const list = document.getElementById('lobbyList');
            list.innerHTML = '';
            
            // Actualizaci√≥n forzada del contador
            document.getElementById('playerCount').innerText = players.length;

            players.forEach(p => {
                const li = document.createElement('li');
                let html = `<span>${p.name} ${p.isHost ? 'üëë' : ''}</span>`;
                if(isHost && p.id !== peer.id) {
                    html += `<button class="kick-btn" onclick="kickPlayer('${p.id}')">Bye</button>`;
                }
                li.innerHTML = html;
                list.appendChild(li);
            });
        }

        function copyRoomCode() {
            const el = document.getElementById('roomIdDisplay');
            el.select();
            navigator.clipboard.writeText(el.value);
            el.style.backgroundColor = "#ffebf0";
            setTimeout(() => el.style.backgroundColor = "white", 300);
        }
    </script>
</body>
</html>
