<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÄ Impostor Coquette Ultimate</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #2b1d22;      /* Fondo base oscuro-rosado */
            --card-bg: rgba(50, 30, 40, 0.85); /* Tarjeta semitransparente */
            --pink-light: #ffc2d1;    /* Rosa pastel */
            --pink-pop: #ff8fab;      /* Rosa chicle */
            --text-main: #ffe5ec;     /* Blanco rosado */
            --text-sec: #e0b0be;      /* Rosa gris√°ceo */
            --accent: #fb6f92;        /* Acento fuerte */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 143, 171, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(251, 111, 146, 0.1) 0%, transparent 40%);
        }

        /* EMOJIS FLOTANTES MEJORADOS */
        .bg-emojis {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1; overflow: hidden; opacity: 0.4;
        }
        .bg-emoji {
            position: absolute; font-size: 1.5rem;
            animation: floatUp 25s linear infinite;
            text-shadow: 0 0 5px rgba(255, 194, 209, 0.5);
        }
        @keyframes floatUp {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            color: var(--pink-pop);
            margin: 10px 0;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.3), 0 0 15px var(--pink-pop);
        }

        .tagline {
            background: rgba(255, 194, 209, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--text-sec);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .container {
            background-color: var(--card-bg);
            backdrop-filter: blur(12px);
            padding: 2.5rem;
            border-radius: 25px;
            border: 1px solid rgba(255, 194, 209, 0.2);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            max-width: 600px;
            width: 100%;
            text-align: center;
            position: relative;
            transition: transform 0.3s;
        }

        input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0,0,0,0.3);
            border: 2px solid var(--pink-light);
            border-radius: 15px;
            color: var(--text-main);
            font-family: 'Quicksand', sans-serif;
            font-size: 1.1rem;
            text-align: center;
            outline: none;
        }
        input:focus { border-color: var(--pink-pop); box-shadow: 0 0 10px var(--pink-pop); }

        button {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: linear-gradient(135deg, var(--pink-pop) 0%, var(--accent) 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 4px 15px rgba(251, 111, 146, 0.4);
        }
        button:hover { transform: scale(1.02); filter: brightness(1.1); }
        
        button.secondary {
            background: transparent;
            border: 2px solid var(--text-sec);
            color: var(--text-sec);
            box-shadow: none;
        }
        button.secondary:hover { border-color: var(--pink-light); color: var(--pink-light); }
        
        button.danger { background: linear-gradient(135deg, #ff4d6d 0%, #c9184a 100%); }

        .hidden { display: none !important; }

        .player-list { list-style: none; padding: 0; text-align: left; }
        .player-list li {
            background: rgba(255, 255, 255, 0.05);
            margin: 8px 0; padding: 10px 15px;
            border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 3px solid var(--pink-pop);
        }

        .role-card {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 20px;
            border: 1px dashed var(--text-sec);
            margin-top: 15px;
        }

        .secret-word {
            font-family: 'Dancing Script', cursive;
            font-size: 2.8rem;
            color: var(--pink-light);
            margin: 10px 0;
            text-shadow: 0 0 10px var(--accent);
            word-wrap: break-word;
        }

        .description-box {
            font-size: 0.95rem;
            color: var(--text-sec);
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-style: italic;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .impostor-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: #ff4d6d;
            text-shadow: 0 0 15px #ff4d6d;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 50% { opacity: 0.7; transform: scale(0.98); } }

        .turn-list { text-align: left; margin-top: 20px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px; }
        .turn-list li { border-bottom: 1px solid rgba(255,255,255,0.1); padding: 5px 0; color: var(--text-sec); }
        .turn-list li:first-child { color: var(--pink-light); font-weight: bold; }

        #roomIdDisplay { 
            font-family: monospace; font-size: 1.2rem; letter-spacing: 2px; color: var(--pink-light);
            background: rgba(0,0,0,0.4); padding: 10px; border-radius: 10px; cursor: pointer; display: inline-block;
        }

        .kick-btn { width: auto; padding: 4px 8px; font-size: 0.7rem; margin: 0; background: transparent; border: 1px solid #ff4d6d; color: #ff4d6d; box-shadow: none; }
        .kick-btn:hover { background: #ff4d6d; color: white; }

    </style>
</head>
<body>

    <div id="emoji-bg" class="bg-emojis"></div>

    <h1>The Impostor</h1>
    <div class="tagline">‚ú® Ultimate Coquette Edition ‚ú®</div>
    <div id="statusMsg" style="color: var(--text-sec); font-size: 0.8rem; min-height: 20px;"></div>

    <div id="screen-menu" class="container">
        <h2 style="font-family:'Dancing Script'; color: var(--pink-light);">¬øQui√©n eres hoy?</h2>
        <input type="text" id="myUsername" placeholder="Tu nombre lindo..." maxlength="12">
        <button onclick="createGame()">Crear Sala üéÄ</button>
        <div style="margin: 15px 0; font-size: 0.8rem; color: var(--text-sec);">‚Äî o √∫nete a tus amigas ‚Äî</div>
        <input type="text" id="joinInput" placeholder="C√≥digo de sala">
        <button class="secondary" onclick="joinGame()">Unirse ‚ú®</button>
    </div>

    <div id="screen-lobby" class="container hidden">
        <h2>Sala de Espera üß∏</h2>
        <p style="color: var(--text-sec); font-size: 0.9rem;">Toca el c√≥digo para copiar:</p>
        <div id="roomIdDisplay" onclick="copyRoomCode()">Cargando...</div>

        <div style="margin-top: 20px; text-align: left;">
            <h3 style="color: var(--pink-light); font-family: 'Dancing Script';">Jugadoras (<span id="playerCount">0</span>)</h3>
        </div>
        <ul id="lobbyList" class="player-list"></ul>

        <div id="hostControls" class="hidden" style="margin-top: 25px;">
            <div style="background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 10px; font-size: 0.8rem; color: var(--text-sec); margin-bottom: 15px; text-align: left;">
                üìö <b>Base de Datos:</b> Ultimate (Cine, M√∫sica, Coquette, Gamer, Deportes...)
            </div>
            <button onclick="startGame()" id="btnStart">üíñ Empezar Partida üíñ</button>
        </div>
        <div id="clientWaiting" class="hidden">
            <p style="color: var(--pink-pop); animation: pulse 1.5s infinite;">Esperando a la anfitriona... ü¶¢</p>
        </div>
    </div>

    <div id="screen-game" class="container hidden">
        <div class="role-card">
            <p style="color: var(--text-sec); font-size: 0.8rem; letter-spacing: 1px; text-transform: uppercase;">Tu Identidad Secreta:</p>
            <h3 id="roleDisplay" style="font-family: 'Dancing Script'; font-size: 2.2rem; margin: 5px 0;">...</h3>
            
            <div id="wordContainer">
                <hr style="border: 0; border-top: 1px dashed rgba(255,255,255,0.2); margin: 15px 0;">
                <p style="font-size:0.8rem; color: var(--text-sec);">LA PALABRA ES:</p>
                <div id="secretWordDisplay" class="secret-word">???</div>
                <div id="secretDescDisplay" class="description-box">Cargando definici√≥n...</div>
            </div>
            
            <div id="impostorMessage" class="hidden">
                <hr style="border: 0; border-top: 1px dashed rgba(255,255,255,0.2); margin: 15px 0;">
                <div class="impostor-title">IMPOSTORA</div>
                <p style="color: var(--text-main);">Shhh... ü§´<br>No sabes nada, solo act√∫a natural.</p>
            </div>
        </div>

        <div style="margin-top: 20px;">
            <p style="text-align: left; color: var(--pink-light); font-weight: bold;">ü©∞ Orden de Turnos:</p>
            <ol id="turnOrderList" class="turn-list"></ol>
        </div>
        
        <div id="hostGameControls" class="hidden" style="margin-top: 20px;">
            <button class="danger" onclick="revealGame()">üíî Terminar Ronda</button>
        </div>
        <p id="waitingReveal" class="hidden" style="margin-top:20px; color: var(--text-sec); font-size: 0.8rem;">Jugando... ‚ú®</p>
    </div>

    <div id="screen-result" class="container hidden">
        <h2 style="font-family: 'Dancing Script'; color: var(--pink-light);">Resultados</h2>
        
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-bottom: 20px;">
            <p style="color: var(--text-sec); font-size: 0.8rem;">La palabra era:</p>
            <div id="finalWord" style="font-size: 2rem; color: var(--pink-pop); font-family: 'Dancing Script'; font-weight: bold;"></div>
            <p id="finalDesc" style="font-size: 0.8rem; color: var(--text-sec); font-style: italic;"></p>
        </div>

        <p style="color: var(--text-sec);">La Impostora era:</p>
        <h3 id="finalImpostor" style="font-family: 'Dancing Script'; font-size: 2.5rem; color: #ff4d6d; margin: 0;"></h3>
        
        <div id="hostRestartControls" class="hidden">
            <button onclick="returnToLobby()">üîÑ Volver al Lobby</button>
        </div>
        <p id="clientRestartWaiting" class="hidden" style="color: var(--text-sec);">Esperando al Host...</p>
    </div>

    <script>
        // --- BASE DE DATOS MASIVA (ULTIMATE) ---
        const cineYSeries = [
             "Star Wars", "Darth Vader", "Yoda", "Luke Skywalker", "Princesa Leia", "Han Solo", "Chewbacca", "R2-D2", "C-3PO", "Mandaloriano", "Grogu", "Sable de Luz", "Estrella de la Muerte", "Halc√≥n Milenario", "Tatooine", "Ewok", "Jedi", "Sith", "Kylo Ren", "Rey", "Stormtrooper", "Imperio", "Rebeli√≥n",
            "Harry Potter", "Hogwarts", "Hermione Granger", "Ron Weasley", "Dumbledore", "Voldemort", "Snape", "Hagrid", "Dobby", "Varita", "Snitch Dorada", "Quidditch", "And√©n 9 ¬æ", "Gryffindor", "Slytherin", "Patronus", "Horrocrux", "Elfo Dom√©stico", "Muggle", "Callej√≥n Diagon",
            "El Se√±or de los Anillos", "Frodo", "Gandalf", "Aragorn", "Legolas", "Gimli", "Gollum", "Sauron", "Anillo √önico", "Mordor", "La Comarca", "Hobbit", "Monte del Destino", "Tierra Media", "Rivendel", "Nazgul", "Orco", "Elfo",
            "Marvel", "UCM", "Avengers", "Iron Man", "Capit√°n Am√©rica", "Thor", "Hulk", "Viuda Negra", "Spider-Man", "Thanos", "Guantelete del Infinito", "Gema del Infinito", "Loki", "Wanda Maximoff", "Bruja Escarlata", "Doctor Strange", "Guardianes de la Galaxia", "Groot", "Rocket", "Wakanda", "Black Panther", "Deadpool", "Wolverine", "X-Men", "Magneto",
            "DC Comics", "Batman", "Joker", "Superman", "Wonder Woman", "Flash", "Aquaman", "Harley Quinn", "Gotham", "Batmovil", "Kryptonita", "Liga de la Justicia", "Robin", "Catwoman", "Enigma", "Ping√ºino",
            "Dune", "Paul Atreides", "Chani", "Lisan al Gaib", "Arrakis", "Gusano de Arena", "La Especia", "Harkonnen", "Fremen", "Bene Gesserit", "Ornithopter",
            "Juego de Tronos", "Jon Snow", "Daenerys", "Tyrion", "Cersei", "Arya", "Sansa", "Drag√≥n", "Trono de Hierro", "Invernalia", "Caminante Blanco", "Dracarys", "La Casa del Drag√≥n", "Rhaenyra",
            "Titanic", "Iceberg", "Jack y Rose", "Avatar", "Pandora", "Na'vi", "Barbie", "Ken", "Mojo Dojo Casa House", "Oppenheimer", "Bomba At√≥mica", "Jurassic Park", "T-Rex", "Velociraptor", "√Åmbar", "Volver al Futuro", "Delorean", "McFly", "Condensador de Fluzo", "Pulp Fiction", "Vincent Vega", "Mia Wallace", "El Padrino", "Corleone", "Cabeza de Caballo", "Matrix", "Neo", "Pastilla Roja", "Stranger Things", "Eleven", "Demogorgon", "Upside Down", "Friends", "Central Perk", "Sof√°", "Breaking Bad", "Heisenberg", "Meta Azul", "Los Pollos Hermanos", "Caravana", "Squid Game", "Luz Verde Luz Roja", "La Casa de Papel", "M√°scara de Dal√≠", "Bella Ciao", "The Office", "Dunder Mifflin", "Grapadora en gelatina", "Wednesday", "Dedos", "Bridgerton", "Lady Whistledown", "Gossip Girl", "XOXO", "Euphoria", "Brilli Brilli", "The Bear", "Yes Chef", "Succession", "Waystar Royco", "Black Mirror", "Tecnolog√≠a", "Rick y Morty", "Pistola de portales", "Pickle Rick", "Los Simpson", "Donut", "Cerveza Duff", "Springfield", "Crep√∫sculo", "Edward Cullen", "Bella Swan", "Vampiro brillante", "Hombre Lobo", "Team Edward", "Team Jacob", "Mean Girls", "Burn Book", "Las Divinas", "High School Musical",
            "Steven Spielberg", "Christopher Nolan", "Quentin Tarantino", "Martin Scorsese", "Wes Anderson", "Simetr√≠a", "Tim Burton", "G√≥tico", "Greta Gerwig", "Sofia Coppola", "Aesthetic", "Alfred Hitchcock", "Suspense", "Stanley Kubrick", "Hayao Miyazaki", "Studio Ghibli", "Totoro", "Pedro Almod√≥var", "Guillermo del Toro", "A24", "Cine Indie", "Blumhouse", "Terror", "Disney", "Pixar", "Castillo", "Warner Bros", "Universal", "Netflix", "HBO", "Prime Video",
            "Leonardo DiCaprio", "Brad Pitt", "Tom Cruise", "Johnny Depp", "Meryl Streep", "Angelina Jolie", "Jennifer Lawrence", "Emma Stone", "Ryan Gosling", "Margot Robbie", "Zendaya", "Timoth√©e Chalamet", "Florence Pugh", "Anya Taylor-Joy", "Ana de Armas", "Pedro Pascal", "Jenna Ortega", "Millie Bobby Brown", "Henry Cavill", "Robert Pattinson", "Cillian Murphy", "Marilyn Monroe", "Audrey Hepburn", "Elvis Presley", "James Dean",
            "Oscar", "Alfombra Roja", "Palomitas", "Claqueta", "Director", "Guion", "Croma", "Efectos Especiales", "CGI", "Cameo", "Spoiler", "Plot Twist", "Tr√°iler", "Premiere", "Butaca", "Proyector", "Pantalla Imax"
        ];
        const videojuegos = [
            "Super Mario", "Luigi", "Peach", "Bowser", "Yoshi", "Toad", "Reino Champi√±√≥n", "Estrella", "Tuber√≠a", "Mario Kart", "Caparaz√≥n Azul", "Senda Arco√≠ris", 
            "Zelda", "Link", "Ganondorf", "Trifuerza", "Espada Maestra", "Hyrule", "Epona", "Ocarina", "Breath of the Wild", "Tears of the Kingdom",
            "Pok√©mon", "Pikachu", "Charizard", "Eevee", "Pok√©ball", "Entrenador", "Gimnasio", "Pokedex", "Team Rocket", "Legendario", "Shiny",
            "Minecraft", "Steve", "Alex", "Creeper", "Enderman", "Diamante", "Pico", "Mesa de Crafteo", "Nether", "Obsidiana", "Aldeano",
            "Roblox", "Obby", "Adopt Me", "Oof", "Fortnite", "Pase de Batalla", "Baile", "Autob√∫s de Batalla", "Construcci√≥n", "Skin", "Pavo",
            "League of Legends", "LoL", "Grieta del Invocador", "Teemo", "Yasuo", "Ahri", "Jinx", "Arcane", "Faker", "Pentakill", "Bar√≥n",
            "Valorant", "Jett", "Sage", "Spike", "Defuse", "Headshot", "Counter Strike", "Rush B", "Call of Duty", "Warzone", "Gulag", "Campero", "Nuketown",
            "Los Sims", "Plumbob", "Simlish", "√ëiqui √ëiqui", "Motherlode", "Piscina sin escalera", "Animal Crossing", "Tom Nook", "Bayas", "Canela", "Nabo",
            "GTA V", "Los Santos", "Trevor", "Coches", "Atraco", "5 Estrellas", "Red Dead Redemption", "Arthur Morgan", "Caballo", "Vaquero", "Far West",
            "The Last of Us", "Ellie", "Joel", "Chasqueador", "Hongo", "Cordyceps", "God of War", "Kratos", "Atreus", "Hacha Leviat√°n", "Espadas del Caos",
            "Elden Ring", "Dark Souls", "Malenia", "Hoguera", "You Died", "Git Gud", "FromSoftware", "Hollow Knight", "Stardew Valley", "Granja",
            "Cyberpunk 2077", "Night City", "Keanu Reeves", "Implante", "Bug", "Resident Evil", "Umbrella", "Zombis", "Leon S. Kennedy", "Nemesis", "Silent Hill", "Niebla",
            "Final Fantasy", "Cloud", "Sephiroth", "Chocobo", "Cristal", "Street Fighter", "Hadouken", "Chun-Li", "Ryu", "Mortal Kombat", "Fatality", "Scorpion", "Sub-Zero",
            "Sonic", "Anillos", "Tails", "Eggman", "Erizo Azul", "Pac-Man", "Fantasma", "Cereza", "Tetris", "Pieza L", "L√≠nea", "Candy Crush", "Color Bomb", "Among Us", "Impostor", "Tripulante", "Ventilaci√≥n", "Sus", "Reportar",
            "Nintendo", "Switch", "PlayStation", "PS5", "Mando", "DualSense", "Xbox", "Game Pass", "PC Master Race", "Steam", "Teclado Mec√°nico", "RGB", "Mouse", "Auriculares", "Silla Gamer", "Streamer", "Twitch", "Chat", "Donaci√≥n", "Banear", "Lag", "Ping", "FPS", "Glitch", "Bug", "Speedrun", "Noob", "Pro", "Tryhard", "GG", "WP", "AFK", "Respawn", "Loot", "Farmear", "Boss", "Nivel", "XP", "Mana", "HP", "Hitbox", "DLC", "Early Access", "Beta", "Game Over", "Insert Coin"
        ];
        const deportes = [
            "M√°laga CF", "La Rosaleda", "Boquer√≥n", "Costa del Sol", "Blanquiazul", "Frente Boker√≥n", "Isco", "Santi Cazorla", "Dely Vald√©s", "Weligton", "Toulalan", "Van Nistelrooy", "Pellegrini", "Champions League del M√°laga", "Duda", "Juanito", "Kameni", "Antonio Banderas", "El Cautivo", "Caminito del Rey", "Espeto",
            "Lionel Messi", "Leo Messi", "Cristiano Ronaldo", "CR7", "Siuuu", "Diego Maradona", "Pel√©", "Johan Cruyff", "Zinedine Zidane", "Ronaldo Nazario", "Ronaldinho", "Neymar", "Mbapp√©", "Haaland", "Vinicius", "Bellingham", "Lamine Yamal", "Pedri", "Gavi", "Lewandowski", "Sergio Ramos", "Iniesta", "Xavi", "Casillas", "Piqu√©", "Beckham",
            "Alexia Putellas", "Aitana Bonmat√≠", "Jenni Hermoso", "Salma Paralluelo", "Megan Rapinoe", "Alex Morgan", "Marta Vieira", "Sam Kerr", "Bal√≥n de Oro", "Mundial", "Copa del Mundo",
            "Real Madrid", "FC Barcelona", "Bar√ßa", "Atl√©tico de Madrid", "Manchester City", "Manchester United", "Liverpool", "Arsenal", "PSG", "Bayern Munich", "Juventus", "Milan", "Boca Juniors", "River Plate",
            "Gol", "Penalti", "Fuera de Juego", "VAR", "C√≥rner", "Portero", "√Årbitro", "Tarjeta Roja", "Tarjeta Amarilla", "Pr√≥rroga", "Tanda de Penaltis", "Chilena", "Regate", "Hat-trick", "Estadio", "Grada", "Hinchada", "Bufanda",
            "Michael Jordan", "Air Jordan", "Chicago Bulls", "LeBron James", "The King", "Lakers", "Kobe Bryant", "Black Mamba", "Shaquille O'Neal", "Shaq", "Stephen Curry", "Chef Curry", "Warriors", "Triple", "Magic Johnson", "Larry Bird", "Dennis Rodman", "Pau Gasol", "Marc Gasol", "Luka Doncic", "Giannis Antetokounmpo", "Nikola Jokic", "Wembanyama", "Kevin Durant", "James Harden", "Kyrie Irving",
            "Canasta", "Mate", "Dunk", "Alley-oop", "Tap√≥n", "Rebote", "Tiro Libre", "Bocina", "Playoffs", "Anillo NBA", "Draft", "All-Star",
            "Tenis", "Rafa Nadal", "Roger Federer", "Novak Djokovic", "Carlos Alcaraz", "Serena Williams", "Sharapova", "Wimbledon", "Roland Garros", "Raqueta", "Punto de Set",
            "F√≥rmula 1", "Fernando Alonso", "Nano", "33", "Lewis Hamilton", "Max Verstappen", "Ferrari", "Red Bull", "Mercedes", "Aston Martin", "Pit Stop", "Semaforo", "Bandera a Cuadros", "Safety Car", "MotoGP", "Marc M√°rquez", "Valentino Rossi",
            "Juegos Ol√≠mpicos", "Medalla de Oro", "Usain Bolt", "Simone Biles", "Michael Phelps", "Atletismo", "Nataci√≥n", "Gimnasia", "Boxeo", "Mike Tyson", "Muhammad Ali", "Canelo", "McGregor", "UFC", "Ring", "KO", "Golf", "Tiger Woods", "Hoyo en uno", "Rugby", "Touchdown", "Super Bowl"
        ];
        const musica = [
            "Taylor Swift", "Swiftie", "Eras Tour", "Cardigan", "All Too Well", "Travis Kelce", "Lana Del Rey", "Summertime Sadness", "Vinyl", "Coquette Music", "Born to Die", "Beyonc√©", "Queen B", "Renaissance", "Single Ladies", "Rihanna", "Umbrella", "Fenty", "Super Bowl", "Lady Gaga", "Bad Romance", "A Star is Born", "Ariana Grande", "Coleta Alta", "Thank u next", "Billie Eilish", "Pelo Verde", "Bad Guy", "Dua Lipa", "Levitating", "Olivia Rodrigo", "Drivers License", "Miley Cyrus", "Hannah Montana", "Flowers", "Selena Gomez", "Katy Perry", "Britney Spears", "Free Britney", "Madonna", "Shakira", "Loba", "Karol G", "La Bichota", "Rosal√≠a", "Motomami", "Tra Tr√°", "Aitana", "Lola √çndigo",
            "Michael Jackson", "Rey del Pop", "Moonwalk", "Thriller", "Freddie Mercury", "Queen", "Bohemian Rhapsody", "Bigote", "The Beatles", "Abbey Road", "John Lennon", "Paul McCartney", "Elvis Presley", "Rey del Rock", "Tup√©", "David Bowie", "Ziggy Stardust", "Prince", "Purple Rain", "Nirvana", "Kurt Cobain", "Grunge", "Rolling Stones", "Mick Jagger", "Lengua", "AC/DC", "Metallica", "Guns N Roses", "Slash", "Pink Floyd", "Elton John", "Piano", "Amy Winehouse", "Rehab", "Adele", "Whitney Houston",
            "Eminem", "Rap God", "Kanye West", "Yeezy", "Drake", "Kendrick Lamar", "Travis Scott", "Bad Bunny", "Conejo Malo", "Un Verano Sin Ti", "J Balvin", "Colores", "Daddy Yankee", "Gasolina", "Reggaeton", "Feid", "Ferxxo", "Verde", "Maluma", "Bizarrap", "Sesi√≥n 53", "Quevedo", "C. Tangana", "El Madrile√±o", "Rauw Alejandro", "Duki",
            "BTS", "Army", "Jungkook", "Dynamite", "Blackpink", "Lisa", "Jennie", "K-Pop", "Idol", "Lightstick",
            "Micr√≥fono", "Guitarra El√©ctrica", "Bater√≠a", "Bajo", "Viol√≠n", "Piano de Cola", "Saxof√≥n", "Trompeta", "DJ", "Mesa de Mezclas", "Vinilo", "Cassette", "CD", "Spotify", "Playlist", "Auriculares", "Altavoz", "Concierto", "Festival", "Coachella", "Grammy", "Videoclip", "Autotune", "Playback", "Gira Mundial", "Backstage", "Fan", "Groupie"
        ];
        const estiloDeVida = [
            "Lazo", "Mo√±o Rosa", "Perlas", "Encaje", "Volantes", "Vestido de Flores", "Corset", "Bailarinas", "Tacones", "Lipstick", "Gloss", "R√≠mel", "Eyeliner", "Colorete", "Skincare", "Mascarilla", "Perfume", "Chanel", "N¬∫5", "Dior", "Gucci", "Prada", "Louis Vuitton", "Bolso de lujo", "Versace", "Balenciaga", "Zara", "Shein", "H&M", "Nike", "Adidas", "Vogue", "Met Gala", "Pasarela", "Modelo", "Supermodelo", "Influencer", "Aesthetic", "Vintage", "Retro", "Y2K", "Old Money", "Dark Academia", "Cottagecore", "Pinterest", "Instagram", "TikTok", "Selfie", "Filtro",
            "Par√≠s", "Torre Eiffel", "Louvre", "Croissant", "Nueva York", "Estatua de la Libertad", "Times Square", "Central Park", "Taxi Amarillo", "Londres", "Big Ben", "Cabina Roja", "Tokio", "Cruce de Shibuya", "Monte Fuji", "Sushi", "Roma", "Coliseo", "Pizza", "Venecia", "G√≥ndola", "Egipto", "Pir√°mides", "Desierto", "Dub√°i", "Rascacielos", "Burj Khalifa", "Los √Ångeles", "Hollywood", "Cartel de Hollywood", "Las Vegas", "Casino", "Haw√°i", "Playa", "Volc√°n", "R√≠o de Janeiro", "Cristo Redentor", "Carnaval", "Mosc√∫", "Plaza Roja", "S√≠dney", "√ìpera", "Canguro", "Muralla China", "Taj Mahal", "Polo Norte", "Igl√∫", "Espacio", "Luna", "Marte",
            "M√≥vil", "iPhone", "Cargador", "Bater√≠a", "Wifi", "Port√°til", "Teclado", "Rat√≥n", "Tele", "Mando", "Netflix", "Sof√°", "Manta", "Coj√≠n", "Cama", "Almohada", "Despertador", "Espejo", "Cepillo", "Secador", "Plancha", "Lavadora", "Nevera", "Microondas", "Horno", "Sart√©n", "Taza", "Caf√©", "Vaso", "Botella", "Cuchillo", "Tenedor", "Plato", "Mesa", "Silla", "L√°mpara", "Bombilla", "Vela", "Libro", "Cuaderno", "Bol√≠grafo", "L√°piz", "Goma", "Tijeras", "Llaves", "Cartera", "Dinero", "Tarjeta", "Moneda", "Gafas de Sol", "Paraguas", "Maleta", "Mochila", "Reloj", "Anillo", "Collar", "Pendientes", "Coche", "Moto", "Bici", "Patinete", "Autob√∫s", "Metro", "Avi√≥n", "Tren", "Barco",
            "Pizza", "Hamburguesa", "Patatas Fritas", "Sushi", "Ramen", "Tacos", "Burrito", "Nachos", "Pasta", "Espaguetis", "Lasa√±a", "Arroz", "Paella", "Pollo Frito", "Nuggets", "Helado", "Chocolate", "Tarta", "Donut", "Cookie", "Macaron", "Croissant", "Tortita", "Gofre", "Fruta", "Fresa", "Pl√°tano", "Manzana", "Sand√≠a", "Aguacate", "Huevo", "Bacon", "Queso", "Pan", "Leche", "Caf√©", "Matcha", "Boba Tea", "Coca-Cola", "Agua", "Cerveza", "Vino", "Champ√°n", "C√≥ctel"
        ];
        const conceptosYMas = [
            "M√©dico", "Enfermera", "Cirujano", "Polic√≠a", "Ladr√≥n", "Detective", "Esp√≠a", "Juez", "Abogado", "Bombero", "Astronauta", "Cient√≠fico", "Profesor", "Alumno", "Director", "Actor", "Cantante", "Pintor", "Escritor", "Cocinero", "Chef", "Camarero", "Piloto", "Azafata", "Mec√°nico", "Fontanero", "Electricista", "Carpintero", "Jardinero", "Agricultor", "Peluquero", "Maquillador", "Presidente", "Rey", "Reina", "Pr√≠ncipe", "Princesa", "Soldado", "General", "Hacker", "Youtuber", "Streamer", "Influencer", "Millonario", "Vagabundo", "Fantasma", "Vampiro", "Zombi", "Alien", "Bruja", "Mago", "Payaso", "Mimo", "Robot",
            "Amor", "Coraz√≥n", "Odio", "Felicidad", "Sonrisa", "Tristeza", "L√°grima", "Miedo", "Grito", "Sorpresa", "Ira", "Fuego", "Verg√ºenza", "Celos", "Envidia", "Esperanza", "Fe", "Paz", "Paloma", "Guerra", "Tanque", "Libertad", "Cadenas", "Justicia", "Balanza", "Verdad", "Mentira", "Pinocho", "Secreto", "Sue√±o", "Pesadilla", "Recuerdo", "Olvido", "Tiempo", "Reloj de Arena", "Pasado", "Futuro", "Eternidad", "Vida", "Muerte", "Esqueleto", "Suerte", "Tr√©bol", "Destino", "Casualidad", "Caos", "Orden", "Ley", "Crimen", "Castigo", "C√°rcel", "Premio", "Trofeo", "Victoria", "Derrota", "Fiesta", "Cumplea√±os", "Navidad", "Halloween", "Boda", "Divorcio",
            "Ornitorrinco", "Caleidoscopio", "Laberinto", "Jerogl√≠fico", "Momia", "Sarc√≥fago", "Guillotina", "Verdugo", "Manicomio", "Camisa de Fuerza", "B√∫nker", "Trinchera", "Kamikaze", "Samur√°i", "Katana", "Ninja", "Vikingo", "Hacha", "Pirata", "Tesoro", "Mapa", "Br√∫jula", "Catalejo", "Garfio", "Pata de Palo", "Loro", "Espantap√°jaros", "Marioneta", "Ventr√≠locuo", "Mu√±eco", "Vud√∫", "Ouija", "Esp√≠ritu", "Exorcismo", "Agua Bendita", "Apocalipsis", "Pandemia", "Mascarilla", "Vacuna", "Microchip", "Iluminati", "Tri√°ngulo", "Ovni", "Area 51", "Abducci√≥n", "Dinosaurio", "Meteorito", "F√≥sil", "Drag√≥n", "Unicornio", "Sirena", "Trit√≥n", "Kraken", "Monstruo del Lago Ness", "Yeti", "Bigfoot"
        ];
        
        const todasLasPalabras = [...cineYSeries, ...videojuegos, ...deportes, ...musica, ...estiloDeVida, ...conceptosYMas];

        // --- FONDO ANIMADO ---
        const emojis = ["üéÄ", "ü¶¢", "ü©∞", "üíÑ", "üßÅ", "üß∏", "üíñ", "üçì", "üïØÔ∏è", "üíå"];
        const bgContainer = document.getElementById('emoji-bg');
        for(let i=0; i<15; i++) {
            const el = document.createElement('div');
            el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            el.className = 'bg-emoji';
            el.style.left = Math.random() * 100 + 'vw';
            el.style.animationDuration = (Math.random() * 20 + 20) + 's';
            el.style.animationDelay = Math.random() * 10 + 's';
            bgContainer.appendChild(el);
        }

        // --- L√ìGICA DE JUEGO ---
        let peer = null;
        let connections = [];
        let isHost = false;
        let myName = "";
        let players = []; 
        let gameState = {}; 

        const screens = ['menu', 'lobby', 'game', 'result'];
        function showScreen(name) {
            screens.forEach(s => document.getElementById(`screen-${s}`).classList.add('hidden'));
            document.getElementById(`screen-${name}`).classList.remove('hidden');
        }
        function updateStatus(msg) { document.getElementById('statusMsg').innerText = msg; }

        async function getWordAndDescription() {
            const rawWord = todasLasPalabras[Math.floor(Math.random() * todasLasPalabras.length)];
            
            // Buscar descripci√≥n en Wikipedia para enriquecer la experiencia
            const url = `https://es.wikipedia.org/w/api.php?action=query&prop=extracts&exintro&explaintext&exchars=280&titles=${encodeURIComponent(rawWord)}&format=json&origin=*`;
            
            let description = "Un concepto ic√≥nico y popular."; // Fallback

            try {
                const res = await fetch(url);
                const data = await res.json();
                const pages = data.query.pages;
                const pageId = Object.keys(pages)[0];
                
                if (pageId !== "-1") {
                    const extract = pages[pageId].extract;
                    if (extract && extract.length > 5) {
                        // Limpiamos un poco el texto
                        description = extract.split('.')[0] + ".";
                        if(description.length > 200) description = description.substring(0, 200) + "...";
                    }
                }
            } catch (e) {
                console.log("Wiki fetch failed, using fallback.");
            }

            return { title: rawWord, desc: description };
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- PEERJS ---
        function createGame() {
            myName = document.getElementById('myUsername').value.trim() || "Baby Doll";
            isHost = true;
            updateStatus("Abriendo salita...");
            peer = new Peer(null, { debug: 1 });
            
            peer.on('open', (id) => {
                document.getElementById('roomIdDisplay').innerText = id;
                updateStatus("");
                players = [{ id: id, name: myName, isHost: true }];
                updateLobbyUI();
                showScreen('lobby');
                document.getElementById('hostControls').classList.remove('hidden');
            });

            peer.on('connection', (c) => {
                c.on('open', () => { c.on('data', (d) => handleDataHost(d, c)); });
                c.on('close', () => {
                    players = players.filter(p => p.id !== c.peer);
                    connections = connections.filter(con => con.peer !== c.peer);
                    broadcastLobby();
                });
            });
        }

        function joinGame() {
            myName = document.getElementById('myUsername').value.trim() || "Angel";
            const roomId = document.getElementById('joinInput').value.trim();
            if (!roomId) return alert("¬°Falta el c√≥digo! ü¶¢");
            
            isHost = false;
            updateStatus("Conectando...");
            peer = new Peer(null, { debug: 1 });
            
            peer.on('open', (id) => {
                const conn = peer.connect(roomId);
                conn.on('open', () => {
                    updateStatus("Conectada");
                    conn.send({ type: 'JOIN', name: myName, id: id });
                    connections = [conn]; 
                });
                conn.on('data', (d) => handleDataClient(d));
                conn.on('close', () => { alert("Desconectada."); location.reload(); });
            });
        }

        function handleDataHost(data, connSource) {
            if (data.type === 'JOIN') {
                if (!players.find(p => p.id === data.id)) {
                    connections.push(connSource);
                    players.push({ id: data.id, name: data.name });
                    broadcastLobby();
                }
            }
        }

        function handleDataClient(data) {
            if (data.type === 'LOBBY') {
                players = data.players;
                showScreen('lobby');
                updateLobbyUI();
                document.getElementById('hostControls').classList.add('hidden');
                document.getElementById('clientWaiting').classList.remove('hidden');
            }
            if (data.type === 'START') setupGame(data.wordData, data.impostor, data.order);
            if (data.type === 'REVEAL') showResult(data.wordData, data.impostorName);
            if (data.type === 'RESET') showScreen('lobby');
        }

        function broadcastLobby() {
            const safePlayers = players.map(p => ({ id: p.id, name: p.name, isHost: p.isHost }));
            const msg = { type: 'LOBBY', players: safePlayers };
            if (!isHost) return;
            updateLobbyUI();
            connections.forEach(c => c.send(msg));
        }

        async function startGame() {
            if (players.length < 3 && !confirm("¬øJugar con menos de 3? Ser√° dif√≠cil.")) return;
            
            const btn = document.getElementById('btnStart');
            btn.innerText = "‚ú® Eligiendo destino ‚ú®";
            btn.disabled = true;

            const wordData = await getWordAndDescription();
            
            const impostor = players[Math.floor(Math.random() * players.length)];
            let turnOrder = [...players];
            turnOrder = shuffleArray(turnOrder).map(p => p.name);

            gameState = { wordData: wordData, impostorName: impostor.name };
            
            const msg = { 
                type: 'START', 
                wordData: wordData, 
                impostor: impostor.id,
                order: turnOrder
            };
            
            connections.forEach(c => c.send(msg));
            setupGame(wordData, impostor.id, turnOrder);

            btn.innerText = "üíñ Empezar Partida üíñ";
            btn.disabled = false;
        }

        function setupGame(wordData, impostorId, orderList) {
            showScreen('game');
            const amIImpostor = (peer.id === impostorId);
            
            const roleTxt = document.getElementById('roleDisplay');
            if (amIImpostor) {
                roleTxt.innerText = "üíî IMPOSTORA";
                roleTxt.style.color = "#ff4d6d";
                document.getElementById('wordContainer').classList.add('hidden');
                document.getElementById('impostorMessage').classList.remove('hidden');
            } else {
                roleTxt.innerText = "üíñ CIUDADANA";
                roleTxt.style.color = "var(--pink-pop)";
                document.getElementById('wordContainer').classList.remove('hidden');
                document.getElementById('impostorMessage').classList.add('hidden');
                
                document.getElementById('secretWordDisplay').innerText = wordData.title;
                document.getElementById('secretDescDisplay').innerText = wordData.desc;
            }

            const ul = document.getElementById('turnOrderList');
            ul.innerHTML = '';
            orderList.forEach((name, index) => {
                const li = document.createElement('li');
                li.innerText = `${index + 1}. ${name}`;
                ul.appendChild(li);
            });

            if (isHost) {
                document.getElementById('hostGameControls').classList.remove('hidden');
                document.getElementById('waitingReveal').classList.add('hidden');
            } else {
                document.getElementById('hostGameControls').classList.add('hidden');
                document.getElementById('waitingReveal').classList.remove('hidden');
            }
        }

        function revealGame() {
            const msg = { type: 'REVEAL', wordData: gameState.wordData, impostorName: gameState.impostorName };
            connections.forEach(c => c.send(msg));
            showResult(msg.wordData, msg.impostorName);
        }

        function showResult(wordData, impostorName) {
            showScreen('result');
            document.getElementById('finalWord').innerText = wordData.title;
            document.getElementById('finalDesc').innerText = wordData.desc;
            document.getElementById('finalImpostor').innerText = impostorName;
            
            if(isHost) {
                document.getElementById('hostRestartControls').classList.remove('hidden');
                document.getElementById('clientRestartWaiting').classList.add('hidden');
            } else {
                document.getElementById('hostRestartControls').classList.add('hidden');
                document.getElementById('clientRestartWaiting').classList.remove('hidden');
            }
        }

        function returnToLobby() {
            broadcastLobby();
            connections.forEach(c => c.send({ type: 'RESET' }));
            showScreen('lobby');
        }

        function updateLobbyUI() {
            const list = document.getElementById('lobbyList');
            list.innerHTML = '';
            document.getElementById('playerCount').innerText = players.length;
            players.forEach(p => {
                const li = document.createElement('li');
                let html = `<span>${p.name} ${p.isHost ? 'üëë' : ''}</span>`;
                if(isHost && p.id !== peer.id) {
                    html += `<button class="kick-btn" onclick="kickPlayer('${p.id}')">Bye</button>`;
                }
                li.innerHTML = html;
                list.appendChild(li);
            });
        }
        
        function kickPlayer(id) {
            if(!confirm("¬øExpulsar?")) return;
            const conn = connections.find(c => c.peer === id);
            if (conn) conn.close();
            players = players.filter(p => p.id !== id);
            connections = connections.filter(c => c.peer !== id);
            broadcastLobby();
        }

        function copyRoomCode() {
            const el = document.getElementById('roomIdDisplay');
            const text = el.innerText;
            if(text === "Cargando...") return;
            navigator.clipboard.writeText(text);
            el.style.color = "white";
            setTimeout(() => el.style.color = "var(--pink-light)", 300);
        }
    </script>
</body>
</html>
