<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÄ Impostor Dark Coquette</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* PALETA DARK COQUETTE */
            --bg-dark: #1a0b12;        /* Fondo casi negro rosado */
            --card-dark: #2d1b22;      /* Tarjetas oscuras */
            --text-main: #ecdfe3;      /* Texto blanco roto */
            --text-dim: #bbaab0;       /* Texto secundario */
            --accent-pink: #d47a96;    /* Rosa viejo elegante */
            --accent-glow: #ffc2d1;    /* Brillo rosado */
            --danger: #ff5c7c;         /* Rojo rosado */
            --gold: #d4af37;           /* Toques dorados */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 50% 0%, #3a1e28 0%, var(--bg-dark) 60%);
        }

        /* FONDO SUTIL DE EMOJIS FLOTANTES */
        .bg-emojis {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1; opacity: 0.15; overflow: hidden;
        }
        .bg-emoji {
            position: absolute; font-size: 1.5rem;
            animation: float 20s linear infinite;
        }
        @keyframes float {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            20% { opacity: 0.5; }
            80% { opacity: 0.5; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 3rem;
            color: var(--accent-glow);
            margin: 10px 0;
            text-shadow: 0 0 15px rgba(255, 194, 209, 0.3);
            letter-spacing: 2px;
        }

        .container {
            background-color: var(--card-dark);
            padding: 3rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 194, 209, 0.1);
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            
            /* M√ÅS ANCHO COMO PEDISTE */
            max-width: 700px; 
            width: 100%;
            
            text-align: center;
            position: relative;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        /* Input Estilizado */
        input {
            width: 100%;
            padding: 15px;
            margin: 12px 0;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--accent-pink);
            border-radius: 10px;
            color: var(--text-main);
            font-family: 'Lato', sans-serif;
            font-size: 1.1rem;
            text-align: center;
            outline: none;
        }
        input:focus { border-color: var(--accent-glow); box-shadow: 0 0 10px rgba(212, 122, 150, 0.2); }

        /* Botones Elegantes */
        button {
            width: 100%;
            padding: 16px;
            margin-top: 15px;
            background: linear-gradient(135deg, #a65870 0%, #d47a96 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            font-family: 'Lato', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: transform 0.2s, filter 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        button:hover { transform: translateY(-2px); filter: brightness(1.1); }
        
        button.secondary {
            background: transparent;
            border: 1px solid var(--text-dim);
            color: var(--text-dim);
            box-shadow: none;
        }
        button.secondary:hover { border-color: var(--accent-glow); color: var(--accent-glow); }

        button.danger { background: linear-gradient(135deg, #b33951 0%, #e64c6e 100%); }

        .hidden { display: none !important; }

        /* LISTAS DE JUGADORES */
        .player-list { list-style: none; padding: 0; text-align: left; }
        .player-list li {
            background: rgba(255,255,255,0.03);
            margin: 8px 0; padding: 12px 20px;
            border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 3px solid var(--accent-pink);
        }

        /* TARJETA DE ROL & JUEGO */
        .role-card {
            background: rgba(0,0,0,0.2);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            margin-top: 10px;
        }

        .secret-word {
            font-family: 'Playfair Display', serif;
            font-size: 3rem; /* M√°s grande */
            color: var(--accent-glow);
            margin: 15px 0;
            text-shadow: 0 0 10px rgba(255, 194, 209, 0.4);
            word-wrap: break-word;
            line-height: 1.1;
        }

        .description-box {
            font-size: 1rem;
            color: var(--text-dim);
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid var(--accent-pink);
            text-align: left;
            margin-top: 10px;
            line-height: 1.5;
        }

        .impostor-title {
            color: var(--danger);
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: bold;
            letter-spacing: 3px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 50% { opacity: 0.6; } }

        /* ORDEN DE TURNOS */
        .turn-list { margin-top: 20px; text-align: left; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; }
        .turn-list li { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); color: var(--text-dim); }
        .turn-list li:first-child { color: var(--accent-glow); font-weight: bold; }
        .turn-list li:first-child::after { content: " ‚ú® (Inicia)"; font-size: 0.8rem; opacity: 0.8; }

        #roomIdDisplay { 
            font-family: monospace; letter-spacing: 2px; color: var(--accent-glow); cursor: pointer;
            background: rgba(0,0,0,0.4); padding: 10px; border-radius: 5px; display: inline-block;
        }
        
        .kick-btn {
            width: auto; padding: 5px 10px; margin: 0; font-size: 0.7rem; 
            background: transparent; border: 1px solid var(--danger); color: var(--danger);
            box-shadow: none;
        }
        .kick-btn:hover { background: var(--danger); color: white; transform: none; }

    </style>
</head>
<body>

    <div id="emoji-bg" class="bg-emojis"></div>

    <h1>The Impostor</h1>
    <div style="font-size: 0.8rem; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px;">
        ‚ú¶ Dark Coquette Edition ‚ú¶
    </div>
    
    <div id="statusMsg" style="color: var(--accent-pink); font-size: 0.9rem; min-height: 20px;"></div>

    <div id="screen-menu" class="container">
        <h2 style="font-family: 'Playfair Display'; color: var(--text-main);">Identif√≠cate</h2>
        <input type="text" id="myUsername" placeholder="Tu nombre..." maxlength="12">
        <button onclick="createGame()">Crear Sala</button>
        <div style="margin: 20px 0; color: var(--text-dim); font-size: 0.8rem;">‚Äî o √∫nete a una existente ‚Äî</div>
        <input type="text" id="joinInput" placeholder="C√≥digo de la sala">
        <button class="secondary" onclick="joinGame()">Unirse</button>
    </div>

    <div id="screen-lobby" class="container hidden">
        <h2>Sala de Espera</h2>
        <p style="color: var(--text-dim);">Toca el c√≥digo para copiarlo:</p>
        
        <div id="roomIdDisplay" onclick="copyRoomCode()">Cargando...</div>

        <div style="margin-top: 30px; text-align: left;">
            <h3 style="color: var(--accent-glow); font-family: 'Playfair Display'; font-size: 1.5rem;">
                Jugadores (<span id="playerCount">0</span>)
            </h3>
        </div>
        <ul id="lobbyList" class="player-list"></ul>

        <div id="hostControls" class="hidden" style="margin-top: 30px;">
            <div style="background: rgba(212, 122, 150, 0.1); padding: 15px; border-radius: 10px; font-size: 0.9rem; color: var(--text-dim); margin-bottom: 15px; text-align: left;">
                ‚ÑπÔ∏è <b>Modo Database:</b> Usando lista personalizada con cientos de palabras. Descargando descripciones en tiempo real.
            </div>
            <button onclick="startGame()" id="btnStart">‚ú¶ Empezar Partida ‚ú¶</button>
        </div>
        <div id="clientWaiting" class="hidden">
            <p style="color: var(--accent-pink); animation: pulse 2s infinite;">Esperando a la anfitriona...</p>
        </div>
    </div>

    <div id="screen-game" class="container hidden">
        <div class="role-card">
            <p style="color: var(--text-dim); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Tu Rol:</p>
            <h3 id="roleDisplay" style="font-family: 'Playfair Display'; font-size: 2rem; margin: 5px 0;">...</h3>
            
            <div id="wordContainer">
                <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;">
                <p style="font-size:0.8rem; color: var(--text-dim);">LA PALABRA SECRETA ES:</p>
                <div id="secretWordDisplay" class="secret-word">???</div>
                
                <div id="secretDescDisplay" class="description-box">Cargando definici√≥n...</div>
            </div>
            
            <div id="impostorMessage" class="hidden">
                <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;">
                <div class="impostor-title">IMPOSTOR</div>
                <p style="color: var(--text-dim);">No conoces la palabra.<br>Escucha, deduce y miente.</p>
            </div>
        </div>

        <div style="margin-top: 25px;">
            <p style="font-size: 1rem; color: var(--accent-glow); font-family: 'Playfair Display'; text-align: left;">Orden de Turnos:</p>
            <ol id="turnOrderList" class="turn-list"></ol>
        </div>
        
        <div id="hostGameControls" class="hidden" style="margin-top: 20px;">
            <button class="danger" onclick="revealGame()">Revelar & Terminar</button>
        </div>
        <p id="waitingReveal" class="hidden" style="margin-top:20px; color: var(--text-dim);">Partida en curso...</p>
    </div>

    <div id="screen-result" class="container hidden">
        <h2 style="font-family: 'Playfair Display'; color: var(--accent-glow);">Resultados</h2>
        
        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
            <p style="color: var(--text-dim); font-size: 0.9rem; margin:0;">La palabra era:</p>
            <div id="finalWord" style="font-size: 2rem; color: var(--text-main); font-family: 'Playfair Display'; margin: 10px 0;"></div>
            <p id="finalDesc" style="font-size: 0.9rem; color: var(--text-dim); font-style: italic;"></p>
        </div>

        <p style="color: var(--text-dim);">El Impostor era:</p>
        <h3 id="finalImpostor" style="font-family: 'Playfair Display'; font-size: 2.5rem; color: var(--danger); margin: 5px 0;"></h3>
        
        <div id="hostRestartControls" class="hidden">
            <button onclick="returnToLobby()">Volver al Lobby</button>
        </div>
        <p id="clientRestartWaiting" class="hidden" style="color: var(--text-dim);">Esperando al Host...</p>
    </div>

    <script>
        // --- BASE DE DATOS MASIVA (Tu Array) ---
        const PALABRAS_JUEGO = [
            // SCIFI & FANTASY
            "Darth Vader", "Luke Skywalker", "Yoda", "Princesa Leia", "Han Solo", "Chewbacca", "Obi-Wan Kenobi", "R2-D2", "C-3PO", "Stormtrooper", "Mandaloriano", "Baby Yoda", "Emperador Palpatine", "Kylo Ren", "Rey Skywalker", "Halc√≥n Milenario", "Estrella de la Muerte", "Tatooine", "Sable de luz", "Jedi", "Sith", "Harry Potter", "Hermione Granger", "Ron Weasley", "Dumbledore", "Voldemort", "Snape", "Hagrid", "Draco Malfoy", "Hogwarts", "Varita m√°gica", "Frodo Bols√≥n", "Gandalf", "Aragorn", "Legolas", "Gollum", "Sauron", "El Anillo √önico", "Mordor", "Jon Snow", "Daenerys Targaryen", "Trono de Hierro", "Drag√≥n", "The Witcher", "Matrix", "Neo",
            // CINE & CELEBS
            "Steven Spielberg", "Christopher Nolan", "Quentin Tarantino", "Leonardo DiCaprio", "Brad Pitt", "Tom Cruise", "Johnny Depp", "Robert De Niro", "Al Pacino", "Meryl Streep", "Angelina Jolie", "Scarlett Johansson", "Margot Robbie", "Ryan Gosling", "Zendaya", "Timoth√©e Chalamet", "Ana de Armas", "Pedro Pascal", "Jenna Ortega", "Will Smith", "Tom Holland", "Robert Downey Jr.", "Chris Hemsworth", "Marilyn Monroe", "Audrey Hepburn", "Elvis Presley", "Avatar", "Titanic", "El Padrino", "Pulp Fiction", "Barbie", "Oppenheimer", "Jurassic Park", "Indiana Jones", "Terminator", "El Rey Le√≥n", "Toy Story", "Shrek", "Frozen", "Mickey Mouse", "Los Vengadores", "Thanos", "Iron Man", "Spiderman", "Batman", "Joker", "Superman", "Wonder Woman", "Stranger Things", "Breaking Bad", "El Juego del Calamar", "La Casa de Papel",
            // GAMING
            "Super Mario", "Luigi", "Princesa Peach", "Bowser", "Minecraft", "Fortnite", "League of Legends", "Valorant", "Call of Duty", "FIFA", "Messi", "Cristiano Ronaldo", "Mbapp√©", "GTA V", "The Last of Us", "God of War", "Kratos", "Zelda", "Link", "Pok√©mon", "Pikachu", "Charizard", "Among Us", "Impostor", "Animal Crossing", "Clash Royale", "Sims", "PlayStation", "Xbox", "Gamer", "Streamer", "Twitch",
            // MUSICA
            "Taylor Swift", "Beyonc√©", "Rihanna", "Lady Gaga", "Ariana Grande", "Billie Eilish", "Dua Lipa", "Harry Styles", "Justin Bieber", "Shakira", "Rosal√≠a", "Bad Bunny", "Karol G", "Michael Jackson", "Freddie Mercury", "Queen", "The Beatles", "Eminem", "Drake", "The Weeknd", "BTS", "Blackpink",
            // MODA & ESTILO
            "Maquillaje", "Lipstick", "Chanel", "Gucci", "Prada", "Louis Vuitton", "Nike", "Adidas", "Zara", "Vestido", "Tacones", "Bolso", "Joyas", "Diamante", "Coquette", "Vintage", "Aesthetic", "Instagram", "TikTok", "Influencer", "Modelo",
            // LUGARES
            "Nueva York", "Estatua de la Libertad", "Par√≠s", "Torre Eiffel", "Londres", "Big Ben", "Tokio", "Roma", "Coliseo", "Madrid", "Barcelona", "Sagrada Familia", "Egipto", "Pir√°mides", "Brasil", "R√≠o de Janeiro", "M√©xico", "Hollywood", "Disney World", "Playa", "Aeropuerto", "Avi√≥n", "Hospital", "Escuela", "Supermercado", "Centro Comercial", "Cine", "Gimnasio", "Estadio", "Discoteca", "Castillo",
            // COMIDA
            "Pizza", "Hamburguesa", "Patatas Fritas", "Sushi", "Tacos", "Pasta", "Paella", "McDonalds", "Starbucks", "Caf√©", "Coca-Cola", "Cerveza", "Vino", "Helado", "Chocolate", "Fruta", "Pl√°tano", "Fresa", "Sand√≠a", "Queso", "Pan",
            // ANIMALES
            "Perro", "Gato", "Le√≥n", "Tigre", "Elefante", "Jirafa", "Mono", "Caballo", "P√°jaro", "√Åguila", "Delf√≠n", "Ballena", "Tibur√≥n", "Serpiente", "Ara√±a", "Dinosaurio", "T-Rex", "Drag√≥n", "Unicornio",
            // OBJETOS
            "M√≥vil", "iPhone", "Port√°til", "Televisi√≥n", "C√°mara", "Reloj", "Gafas", "Dinero", "Tarjeta de Cr√©dito", "Coche", "Moto", "Libro", "Cama", "Sof√°", "Mesa", "Espejo",
            // PROFESIONES
            "M√©dico", "Polic√≠a", "Bombero", "Profesor", "Abogado", "Juez", "Cient√≠fico", "Astronauta", "Piloto", "Cocinero", "Actor", "Cantante", "Futbolista", "Presidente", "Rey",
            // OTROS
            "Amor", "Muerte", "Vida", "Tiempo", "Dinero", "Fama", "Guerra", "Paz", "Navidad", "Halloween", "Verano", "Invierno", "Internet", "Wifi", "Google", "ChatGPT", "Robot", "Inteligencia Artificial"
        ];

        // --- GENERADOR DE FONDO ---
        const emojis = ["üéÄ", "ü¶¢", "ü©∞", "üíÑ", "üßÅ", "üß∏", "üñ§", "ü•Ä", "üïØÔ∏è", "üï∑Ô∏è", "üç∑"];
        const bgContainer = document.getElementById('emoji-bg');
        for(let i=0; i<15; i++) {
            const el = document.createElement('div');
            el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            el.className = 'bg-emoji';
            el.style.left = Math.random() * 100 + 'vw';
            el.style.animationDuration = (Math.random() * 15 + 15) + 's';
            el.style.animationDelay = Math.random() * 10 + 's';
            bgContainer.appendChild(el);
        }

        // --- L√ìGICA DE JUEGO ---
        let peer = null;
        let connections = [];
        let isHost = false;
        let myName = "";
        let players = []; 
        let gameState = {}; 

        const screens = ['menu', 'lobby', 'game', 'result'];
        function showScreen(name) {
            screens.forEach(s => document.getElementById(`screen-${s}`).classList.add('hidden'));
            document.getElementById(`screen-${name}`).classList.remove('hidden');
        }
        function updateStatus(msg) { document.getElementById('statusMsg').innerText = msg; }

        // --- CEREBRO: SELECCI√ìN + B√öSQUEDA DE DESCRIPCI√ìN ---
        async function getWordAndDescription() {
            // 1. Seleccionar palabra de TU lista
            const rawWord = PALABRAS_JUEGO[Math.floor(Math.random() * PALABRAS_JUEGO.length)];
            
            // 2. Buscar descripci√≥n en Wikipedia para enriquecer la experiencia
            // Usamos "opensearch" para obtener un resumen r√°pido o "query extracts"
            const url = `https://es.wikipedia.org/w/api.php?action=query&prop=extracts&exintro&explaintext&exchars=300&titles=${encodeURIComponent(rawWord)}&format=json&origin=*`;
            
            let description = "Concepto popularmente conocido."; // Fallback por defecto

            try {
                const res = await fetch(url);
                const data = await res.json();
                const pages = data.query.pages;
                const pageId = Object.keys(pages)[0];
                
                if (pageId !== "-1") {
                    const extract = pages[pageId].extract;
                    if (extract && extract.length > 10) {
                        description = extract.split('.')[0] + "."; // Primera frase
                    }
                }
            } catch (e) {
                console.log("Wiki fetch failed, using default description.");
            }

            return { title: rawWord, desc: description };
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- PEERJS ---
        function createGame() {
            myName = document.getElementById('myUsername').value.trim() || "Dark Angel";
            isHost = true;
            updateStatus("Invocando sala...");
            peer = new Peer(null, { debug: 1 });
            
            peer.on('open', (id) => {
                document.getElementById('roomIdDisplay').innerText = id;
                updateStatus("");
                players = [{ id: id, name: myName, isHost: true }];
                updateLobbyUI();
                showScreen('lobby');
                document.getElementById('hostControls').classList.remove('hidden');
            });

            peer.on('connection', (c) => {
                c.on('open', () => { c.on('data', (d) => handleDataHost(d, c)); });
                c.on('close', () => {
                    players = players.filter(p => p.id !== c.peer);
                    connections = connections.filter(con => con.peer !== c.peer);
                    broadcastLobby();
                });
            });
        }

        function joinGame() {
            myName = document.getElementById('myUsername').value.trim() || "Lost Soul";
            const roomId = document.getElementById('joinInput').value.trim();
            if (!roomId) return alert("C√≥digo necesario ü•Ä");
            
            isHost = false;
            updateStatus("Conectando...");
            peer = new Peer(null, { debug: 1 });
            
            peer.on('open', (id) => {
                const conn = peer.connect(roomId);
                conn.on('open', () => {
                    updateStatus("Conectado");
                    conn.send({ type: 'JOIN', name: myName, id: id });
                    connections = [conn]; 
                });
                conn.on('data', (d) => handleDataClient(d));
                conn.on('close', () => { alert("Desconectado."); location.reload(); });
            });
        }

        function handleDataHost(data, connSource) {
            if (data.type === 'JOIN') {
                if (!players.find(p => p.id === data.id)) {
                    connections.push(connSource);
                    players.push({ id: data.id, name: data.name });
                    broadcastLobby();
                }
            }
        }

        function handleDataClient(data) {
            if (data.type === 'LOBBY') {
                players = data.players;
                showScreen('lobby');
                updateLobbyUI();
                document.getElementById('hostControls').classList.add('hidden');
                document.getElementById('clientWaiting').classList.remove('hidden');
            }
            if (data.type === 'START') setupGame(data.wordData, data.impostor, data.order);
            if (data.type === 'REVEAL') showResult(data.wordData, data.impostorName);
            if (data.type === 'RESET') showScreen('lobby');
        }

        function broadcastLobby() {
            const safePlayers = players.map(p => ({ id: p.id, name: p.name, isHost: p.isHost }));
            const msg = { type: 'LOBBY', players: safePlayers };
            if (!isHost) return;
            updateLobbyUI();
            connections.forEach(c => c.send(msg));
        }

        async function startGame() {
            if (players.length < 3 && !confirm("Menos de 3 jugadores. ¬øContinuar?")) return;
            
            const btn = document.getElementById('btnStart');
            btn.innerText = "Seleccionando destino...";
            btn.disabled = true;

            // 1. Obtener palabra y descripci√≥n
            const wordData = await getWordAndDescription();
            
            // 2. L√≥gica juego
            const impostor = players[Math.floor(Math.random() * players.length)];
            let turnOrder = [...players];
            turnOrder = shuffleArray(turnOrder).map(p => p.name);

            gameState = { wordData: wordData, impostorName: impostor.name };
            
            const msg = { 
                type: 'START', 
                wordData: wordData, 
                impostor: impostor.id,
                order: turnOrder
            };
            
            connections.forEach(c => c.send(msg));
            setupGame(wordData, impostor.id, turnOrder);

            btn.innerText = "‚ú¶ Empezar Partida ‚ú¶";
            btn.disabled = false;
        }

        function setupGame(wordData, impostorId, orderList) {
            showScreen('game');
            const amIImpostor = (peer.id === impostorId);
            
            const roleTxt = document.getElementById('roleDisplay');
            if (amIImpostor) {
                roleTxt.innerText = "IMPOSTOR ü•Ä";
                roleTxt.style.color = "var(--danger)";
                document.getElementById('wordContainer').classList.add('hidden');
                document.getElementById('impostorMessage').classList.remove('hidden');
            } else {
                roleTxt.innerText = "CIUDADANO ü¶¢";
                roleTxt.style.color = "var(--accent-glow)";
                document.getElementById('wordContainer').classList.remove('hidden');
                document.getElementById('impostorMessage').classList.add('hidden');
                
                document.getElementById('secretWordDisplay').innerText = wordData.title;
                document.getElementById('secretDescDisplay').innerText = wordData.desc;
            }

            const ul = document.getElementById('turnOrderList');
            ul.innerHTML = '';
            orderList.forEach((name, index) => {
                const li = document.createElement('li');
                li.innerText = `${index + 1}. ${name}`;
                ul.appendChild(li);
            });

            if (isHost) {
                document.getElementById('hostGameControls').classList.remove('hidden');
                document.getElementById('waitingReveal').classList.add('hidden');
            } else {
                document.getElementById('hostGameControls').classList.add('hidden');
                document.getElementById('waitingReveal').classList.remove('hidden');
            }
        }

        function revealGame() {
            const msg = { type: 'REVEAL', wordData: gameState.wordData, impostorName: gameState.impostorName };
            connections.forEach(c => c.send(msg));
            showResult(msg.wordData, msg.impostorName);
        }

        function showResult(wordData, impostorName) {
            showScreen('result');
            document.getElementById('finalWord').innerText = wordData.title;
            document.getElementById('finalDesc').innerText = wordData.desc;
            document.getElementById('finalImpostor').innerText = impostorName;
            
            if(isHost) {
                document.getElementById('hostRestartControls').classList.remove('hidden');
                document.getElementById('clientRestartWaiting').classList.add('hidden');
            } else {
                document.getElementById('hostRestartControls').classList.add('hidden');
                document.getElementById('clientRestartWaiting').classList.remove('hidden');
            }
        }

        function returnToLobby() {
            broadcastLobby();
            connections.forEach(c => c.send({ type: 'RESET' }));
            showScreen('lobby');
        }

        function kickPlayer(id) {
            if(!confirm("¬øExpulsar jugador?")) return;
            const conn = connections.find(c => c.peer === id);
            if (conn) conn.close();
            players = players.filter(p => p.id !== id);
            connections = connections.filter(c => c.peer !== id);
            broadcastLobby();
        }

        function updateLobbyUI() {
            const list = document.getElementById('lobbyList');
            list.innerHTML = '';
            document.getElementById('playerCount').innerText = players.length;
            players.forEach(p => {
                const li = document.createElement('li');
                let html = `<span>${p.name} ${p.isHost ? 'üëë' : ''}</span>`;
                if(isHost && p.id !== peer.id) {
                    html += `<button class="kick-btn" onclick="kickPlayer('${p.id}')">Kick</button>`;
                }
                li.innerHTML = html;
                list.appendChild(li);
            });
        }

        function copyRoomCode() {
            const el = document.getElementById('roomIdDisplay');
            const text = el.innerText;
            if(text === "Cargando...") return;
            navigator.clipboard.writeText(text);
            el.style.color = "var(--text-main)";
            setTimeout(() => el.style.color = "var(--accent-glow)", 300);
        }
    </script>
</body>
</html>
